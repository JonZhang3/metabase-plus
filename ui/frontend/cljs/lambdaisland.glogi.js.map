{"version":3,"sources":["lambdaisland/glogi.cljs"],"mappings":"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","names":["lambdaisland.glogi/goog-setLevel","logger","level","js/goog","js/goog.log","js/goog.log.setLevel","goog.log/setLevel","lambdaisland.glogi/goog-logRecord","record","js/goog.log.publishLogRecord","goog.log/publishLogRecord","lambdaisland.glogi/goog-addHandler","handler","js/goog.log.addHandler","goog.log/addHandler","lambdaisland.glogi/goog-removeHandler","js/goog.log.removeHandler","goog.log/removeHandler","lambdaisland.glogi/logger-handlers-prop","lambdaisland.glogi/name-str","x","cljs.core._EQ_","cljs.core/simple-ident?","cljs.core/name","cljs.core/qualified-ident?","cljs.core/namespace","var_args","G__41453","lambdaisland.glogi/logger","js/Error","n","goog.log/getLogger","lambdaisland.glogi/root-logger","lambdaisland.glogi.logger","lambdaisland.glogi/levels","goog.debug.Logger.Level/OFF","goog.debug.Logger.Level/SHOUT","goog.debug.Logger.Level/SEVERE","goog.debug.Logger.Level/WARNING","goog.debug.Logger.Level/INFO","goog.debug.Logger.Level/CONFIG","goog.debug.Logger.Level/FINE","goog.debug.Logger.Level/FINER","goog.debug.Logger.Level/FINEST","goog.debug.Logger.Level/ALL","lambdaisland.glogi/level","lvl","cljs.core.get","lambdaisland.glogi/level-value","lambdaisland.glogi/make-log-record","message","name","exception","js/goog.debug.LogRecord","G__41463","lambdaisland.glogi/log","lambdaisland.glogi.log","goog.log/ENABLED","temp__5735__auto__","l","lambdaisland.glogi/set-level","cljs.core/contains?","G__41472","lambdaisland.glogi/set-levels","lvls","seq__41475","cljs.core/seq","chunk__41477","count__41478","i__41479","vec__41501","cljs.core.nth","cljs.core/chunked-seq?","c__4556__auto__","cljs.core/chunk-first","cljs.core/chunk-rest","cljs.core/count","vec__41516","cljs.core/first","cljs.core/next","cljs.core.keyword","lambdaisland.glogi/enable-console-logging!","instance","goog.debug.Console/instance","js/goog.debug.Console","lambdaisland.glogi/console-autoinstall!","goog.debug.Console/autoInstall","lambdaisland.glogi/popup-logger-window!","G__41532","js/goog.debug.FancyWindow","lambdaisland.glogi/log-to-div!","element","G__41533","js/goog.debug.DivConsole","lambdaisland.glogi/logger-glogi-handlers","goog.object/get","args__4742__auto__","len__4736__auto__","i__4737__auto__","argseq__4743__auto__","cljs.core/IndexedSeq","lambdaisland.glogi/swap-handlers!","seq41535","G__41536","G__41537","self__4723__auto__","f","args","goog.object/set","cljs.core.apply","G__41550","lambdaisland.glogi/add-handler","handler-fn","lambdaisland.glogi.add_handler","log-record-handler","G__41555","clojure.string/lower-case","lambdaisland.glogi.swap_handlers_BANG_","cljs.core/assoc","G__41561","G__41563","lambdaisland.glogi/remove-handler","lambdaisland.glogi.remove_handler","cljs.core/dissoc","lambdaisland.glogi/add-handler-once"],"sourcesContent":["(ns lambdaisland.glogi\n  (:require [goog.log :as glog]\n            [goog.debug.Logger :as Logger]\n            [goog.debug.Logger.Level :as Level]\n            [goog.debug.Console :as Console]\n            [goog.array :as array]\n            [clojure.string :as str]\n            [goog.object :as gobj])\n  (:import [goog.debug Logger Console FancyWindow DivConsole LogRecord]\n           [goog.debug.Logger Level])\n  (:require-macros [lambdaisland.glogi]))\n\n;; Wrappers around goog.log methods which changed in Closure v20210302, so we\n;; can retain backward compatibility. The static method call is the newer\n;; version.\n\n(defn- goog-setLevel [logger level]\n  (if (exists? glog/setLevel)\n    (glog/setLevel logger level)\n    (.setLevel logger level)))\n\n(defn- goog-logRecord [logger record]\n  (if (exists? glog/publishLogRecord)\n    (glog/publishLogRecord logger record)\n    (.logRecord logger record)))\n\n(defn- goog-addHandler [logger handler]\n  (if (exists? glog/addHandler)\n    (glog/addHandler logger handler)\n    (.addHandler logger handler)))\n\n(defn- goog-removeHandler [logger handler]\n  (if (exists? glog/removeHandler)\n    (glog/removeHandler logger handler)\n    (.removeHandler logger handler)))\n\n;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;\n\n(def ^private logger-handlers-prop \"__glogi_handlers__\")\n\n(defn name-str [x]\n  (cond\n    (= :glogi/root x)\n    \"\"\n\n    (string? x)\n    x\n\n    (simple-ident? x)\n    (name x)\n\n    (qualified-ident? x)\n    (str (namespace x) \"/\" (name x))\n\n    :else\n    (str x)))\n\n(defn logger\n  \"Get a logger by name, and optionally set its level. Name can be a string\n  keyword, or symbol. The special keyword :glogi/root returns the root logger.\"\n  (^Logger [n]\n   (glog/getLogger (name-str n)))\n  (^Logger [n level]\n   (glog/getLogger (name-str n) level)))\n\n(def ^Logger root-logger (logger \"\"))\n\n(def levels\n  {:off     Level/OFF\n   :shout   Level/SHOUT\n   :severe  Level/SEVERE\n   :warning Level/WARNING\n   :info    Level/INFO\n   :config  Level/CONFIG\n   :fine    Level/FINE\n   :finer   Level/FINER\n   :finest  Level/FINEST\n   :all     Level/ALL\n\n   ;; pedestal style\n   :trace Level/FINER\n   :debug Level/FINE\n   :warn  Level/WARNING\n   :error Level/SEVERE})\n\n(defn level ^Level [lvl]\n  (get levels lvl))\n\n(defn level-value\n  \"Get the numeric value of a log level (keyword).\"\n  [lvl]\n  (.-value (level lvl)))\n\n(defn make-log-record ^LogRecord [level message name exception]\n  (let [record (LogRecord. level message name)]\n    (when exception\n      (.setException record exception))\n    record))\n\n(defn log\n  \"Output a log message to the given logger, optionally with an exception to be\n  logged.\"\n  ([name lvl message]\n   (log name lvl message nil))\n  ([name lvl message exception]\n   (when glog/ENABLED\n     (when-let [l (logger name)]\n       (goog-logRecord l (make-log-record (level lvl) message name exception))))))\n\n(defn set-level\n  \"Set the level (a keyword) of the given logger, identified by name.\"\n  [name lvl]\n  (assert (contains? levels lvl))\n  (some-> (logger name) (goog-setLevel (level lvl))))\n\n(defn ^:export set-levels\n  \"Convenience function for setting several levels at one.\n\n  Takes a map of logger name => level keyword. The logger name can be a string,\n  keyword, or symbol. The keyword :glogi/root refers to the root logger and is\n  equivalent to using an empty string.\n\n  This function is exported so it is still available in optimized builds to set\n  levels from the javascript console. In this case use nested arrays and\n  strings. Use an empty string for the root logger.\n\n  ``` javascript\n  lambdaisland.glogi.set_levels([[\\\"\\\" \\\"debug\\\"] [\\\"lambdaisland\\\" \\\"trace\\\"]])\n  ```\n  \"\n  [lvls]\n  (doseq [[logger level] lvls\n          :let [level (if (string? level) (keyword level) level)]]\n    (set-level logger level)))\n\n(defn enable-console-logging!\n  \"Log to the browser console. This uses goog.debug.Console directly,\n  use [lambdaisland.glogi.console/install!] for a version that plays nicely with\n  cljs-devtools.\"\n  []\n  (when-let [instance Console/instance]\n    (.setCapturing instance true)\n    (let [instance (Console.)]\n      (set! Console/instance instance)\n      (.setCapturing instance)))\n  nil)\n\n(defn console-autoinstall!\n  \"Log to the browser console if the browser location contains Debug=true.\"\n  []\n  (Console/autoInstall)\n  nil)\n\n(defn popup-logger-window!\n  \"Pop up a browser window which will display log messages. Returns the FancyWindow instance.\"\n  []\n  (doto (FancyWindow.)\n    (.setEnabled true)))\n\n(defn log-to-div!\n  \"Log messages to an element on the page. Returns the DivConsole instance.\"\n  [element]\n  (doto (DivConsole. element)\n    (.setCapturing  true)))\n\n(defn- logger-glogi-handlers [logger]\n  (gobj/get logger logger-handlers-prop))\n\n(defn- swap-handlers! [logger f & args]\n  (gobj/set\n   logger logger-handlers-prop\n   (apply f (logger-glogi-handlers logger) args)))\n\n(defn add-handler\n  \"Add a log handler to the given logger, or to the root logger if no logger is\n  specified. The handler is a function which receives a map as its argument.\n\n  A given handler-fn is only added to a given logger once, even when called\n  repeatedly.\"\n  ([handler-fn]\n   (add-handler \"\" handler-fn))\n  ([name handler-fn]\n   (let [logger (logger name)\n         log-record-handler\n         (fn [^LogRecord record]\n           (handler-fn {:sequenceNumber (.-sequenceNumber_ record)\n                        :time (.-time_ record)\n                        :level (keyword (str/lower-case (.-name (.-level_ record))))\n                        :message (.-msg_ record)\n                        :logger-name (.-loggerName_ record)\n                        :exception (.-exception_ record)}))]\n     (when logger\n       (when-let [handler (get (logger-glogi-handlers logger) handler-fn)]\n         (goog-removeHandler logger handler))\n       (swap-handlers! logger assoc handler-fn log-record-handler)\n       (some-> logger (goog-addHandler log-record-handler))))))\n\n(defn remove-handler\n  ([handler-fn]\n   (remove-handler \"\" handler-fn))\n  ([name handler-fn]\n   (let [logger (logger name)]\n     (when logger\n       (when-let [handler (get (logger-glogi-handlers logger) handler-fn)]\n         (goog-removeHandler logger handler))\n       (swap-handlers! logger dissoc handler-fn)))))\n\n;; Retained for backward compatibility, but we don't add the same handler twice\n;; to the same logger.\n(def add-handler-once add-handler)\n"]}